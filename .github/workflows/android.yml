name: Build Android APK

# ì–¸ì œ ì´ ë¹Œë“œ ì‘ì—…ì„ ì‹¤í–‰í•  ê²ƒì¸ê°€?
on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'maven'

      # [ìƒˆë¡œ ì¶”ê°€ë¨] Gluonì´ ìš”êµ¬í•˜ëŠ” Maven 3.8.8 ë²„ì „ìœ¼ë¡œ ê°•ì œ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì •
      - name: Setup Maven 3.8.8
        run: |
          wget https://archive.apache.org/dist/maven/maven-3/3.8.8/binaries/apache-maven-3.8.8-bin.tar.gz
          tar xzf apache-maven-3.8.8-bin.tar.gz
          echo "${PWD}/apache-maven-3.8.8/bin" >> $GITHUB_PATH

      - name: Setup GraalVM for Gluon
        uses: gluonhq/setup-graalvm@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # [ìˆ˜ì •ë¨] ë””ë²„ê·¸ ì˜µì…˜(-X)ì„ ì§€ì›Œì„œ ë¡œê·¸ë¥¼ ë‹¤ì‹œ ê¹”ë”í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.
      - name: Build Native Android App
        run: mvn gluonfx:build

      - name: Package into APK
        run: mvn gluonfx:package

      # [ìƒˆë¡œ ì¶”ê°€ë¨] íŒ¨í‚¤ì§• ì‹¤íŒ¨ ì‹œ ìˆ¨ê²¨ì§„ ì§„ì§œ ë¡œê·¸ë¥¼ í™”ë©´ì— ì«™ ì¶œë ¥í•´ ì¤ë‹ˆë‹¤!
      - name: Show Packaging Error Logs
        if: failure()
        run: |
          echo "=== ğŸš¨ íŒ¨í‚¤ì§• ìƒì„¸ ì—ëŸ¬ ë¡œê·¸ ğŸš¨ ==="
          cat target/gluonfx/log/*.log
          cat target/gluonfx/aarch64-android/gvm/log/*.log || true

      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Ssul-Pull-eo-jo-APK
          path: target/client/aarch64-android/gvm/*.apk